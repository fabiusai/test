<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Social Mockup</title>
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- Librerie necessarie -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h1 { color: #0033A0; text-align: center; font-size: 2em; margin-bottom: 30px; }
    .global-controls { text-align: center; margin-bottom: 20px; }
    .news-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
    .news-tabs button { background-color: #FFD700; color: #0033A0; border: none; padding: 10px 16px; border-radius: 4px; font-weight: bold; cursor: pointer; }
    .news-tabs button.active { border: 2px solid #0033A0; background-color: #fff; }
    .social-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
    .social-tabs button { background-color: #0033A0; color: white; border: none; padding: 8px 14px; border-radius: 4px; cursor: pointer; }
    .tab-content, .social-section { display: none; }
    .tab-content.active, .social-section.active { display: block; }
    .mockup-container { background: #fff; width: 520px; margin: auto; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .mockup-header img, .mockup-footer img, .mockup-image { width: 100%; display: block; }
    .mockup-text { padding: 10px 15px; font-size: 15px; white-space: pre-wrap; color: #050505; }
    .mockup-text span.link { color: #1877f2; }
    .controls { text-align: center; margin-top: 20px; }
    .controls textarea { width: 520px; height: 80px; padding: 10px; font-size: 14px; margin-bottom: 10px; }
    .controls input[type='file'] { margin-bottom: 10px; }
    .controls button { margin: 4px; padding: 8px 16px; font-size: 14px; border: none; border-radius: 4px; background: #0033A0; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Social Mockup</h1>
  <div class="global-controls">
    <button onclick="resetAllNews()">Cancella tutto</button>
    <button onclick="downloadAllAsZip()">Scarica tutti i mockup (ZIP)</button>
  </div>
  <div class="news-tabs">
    <button class="active" onclick="showNews(1, event)">News 1</button>
    <button onclick="showNews(2, event)">News 2</button>
    <button onclick="showNews(3, event)">News 3</button>
    <button onclick="showNews(4, event)">News 4</button>
    <button onclick="showNews(5, event)">News 5</button>
  </div>

  <!-- Contenuti delle 5 news -->
  ${[1,2,3,4,5].map(i => `
  <div class="tab-content${i===1?' active':''}" id="news${i}">
    <div class="social-tabs">
      <button onclick="showSocial(${i}, 'facebook', event)">Facebook</button>
      <button onclick="showSocial(${i}, 'linkedin', event)">LinkedIn</button>
      <button onclick="showSocial(${i}, 'x', event)">X</button>
      <button onclick="showSocial(${i}, 'instagram', event)">Instagram</button>
    </div>
    ${['facebook','linkedin','x','instagram'].map(platform => `
    <div id="news${i}-${platform}" class="social-section${platform==='facebook'?' active':''}">
      <div class="mockup-container">
        <div class="mockup-header"><img src="Alto${platform.charAt(0).toUpperCase()+platform.slice(1)}.png" alt="header"></div>
        <div class="mockup-text" id="text-news${i}-${platform}"></div>
        <img class="mockup-image" id="img-news${i}-${platform}" style="display:none;" alt="image" />
        <div class="mockup-footer"><img src="Basso${platform.charAt(0).toUpperCase()+platform.slice(1)}.png" alt="footer"></div>
      </div>
    </div>`).join('')}
    <div class="controls">
      <textarea id="textInput-news${i}" placeholder="Scrivi il testo del post..."></textarea><br>
      <input type="file" id="imageInput-news${i}"><br>
      <button onclick="saveNews(${i})">Salva</button>
      <button onclick="resetNews(${i})">Cancella</button>
    </div>
  </div>`).join('')}

<script>
  function showNews(id, e) {
    document.querySelectorAll('.tab-content').forEach(div => div.classList.remove('active'));
    document.querySelectorAll('.news-tabs button').forEach(btn => btn.classList.remove('active'));
    document.getElementById('news' + id).classList.add('active');
    e.currentTarget.classList.add('active');
  }

  function showSocial(newsIndex, platform, e) {
    document.querySelectorAll(`#news${newsIndex} .social-section`).forEach(div => div.classList.remove('active'));
    document.querySelectorAll(`#news${newsIndex} .social-tabs button`).forEach(btn => btn.classList.remove('active'));
    document.getElementById(`news${newsIndex}-${platform}`).classList.add('active');
    e.currentTarget.classList.add('active');
  }

  function formatText(text) {
    return text.replace(/(#[\w\d]+|@[\w\d]+|https?:\/\/\S+)/g, m => `<span class="link">${m}</span>`);
  }

  function saveNews(index) {
    const text = document.getElementById(`textInput-news${index}`).value;
    const formatted = formatText(text);
    const platform = document.querySelector(`#news${index} .social-section.active`).id.split('-')[1];
    document.getElementById(`text-news${index}-${platform}`).innerHTML = formatted;
    if (platform === 'facebook') {
      ['linkedin','x','instagram'].forEach(net => {
        document.getElementById(`text-news${index}-${net}`).innerHTML = formatted;
      });
    }
    localStorage.setItem(`text${index}-${platform}`, text);
    const imgEl = document.getElementById(`img-news${index}-${platform}`);
    if (imgEl.src && imgEl.src.startsWith('data')) {
      localStorage.setItem(`img${index}-${platform}`, imgEl.src);
      if (platform === 'facebook') {
        ['linkedin','x','instagram'].forEach(net => {
          const tgt = document.getElementById(`img-news${index}-${net}`);
          tgt.src = imgEl.src;
          tgt.style.display = 'block';
        });
      }
    }
  }

  function resetNews(index) {
    ['facebook','linkedin','x','instagram'].forEach(net => {
      localStorage.removeItem(`text${index}-${net}`);
      localStorage.removeItem(`img${index}-${net}`);
      document.getElementById(`text-news${index}-${net}`).innerHTML = '';
      const img = document.getElementById(`img-news${index}-${net}`);
      img.src = '';
      img.style.display = 'none';
    });
    document.getElementById(`textInput-news${index}`).value = '';
    document.getElementById(`imageInput-news${index}`).value = null;
  }

  function resetAllNews() {
    for (let i=1; i<=5; i++) resetNews(i);
  }

  function downloadAllAsZip() {
    const zip = new JSZip();
    const activeNews = document.querySelector('.tab-content.active');
    const newsId = activeNews.id;
    const sections = activeNews.querySelectorAll('.social-section');
    const promises = Array.from(sections).map((section, idx) => {
      const wasHidden = !section.classList.contains('active');
      if (wasHidden) section.classList.add('active');
      const mockup = section.querySelector('.mockup-container');
      return html2canvas(mockup, { backgroundColor: '#ffffff' }).then(canvas => {
        return new Promise(resolve => {
          canvas.toBlob(blob => {
            const filename = `${newsId}_mockup_${idx+1}.jpg`;
            zip.file(filename, blob);
            resolve();
          }, 'image/jpeg', 1.0);
        });
      }).finally(() => {
        if (wasHidden) section.classList.remove('active');
      });
    });

    Promise.all(promises).then(() => {
      zip.generateAsync({ type: 'blob' }).then(zipBlob => {
        saveAs(zipBlob, `${newsId}_mockups.zip`);
      });
    });
  }

  window.onload = () => {
    for (let i=1; i<=5; i++) {
      const input = document.getElementById(`imageInput-news${i}`);
      input.addEventListener('change', e => {
        const file = e.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          const platform = document.querySelector(`#news${i} .social-section.active`).id.split('-')[1];
          const img = document.getElementById(`img-news${i}-${platform}`);
          img.src = reader.result; img.style.display = 'block';
        };
        reader.readAsDataURL(file);
      });
      ['facebook','linkedin','x','instagram'].forEach(net => {
        const t = localStorage.getItem(`text${i}-${net}`);
        const img = localStorage.getItem(`img${i}-${net}`);
        if (t) {
          document.getElementById(`text-news${i}-${net}`).innerHTML = formatText(t);
          if (net==='facebook') document.getElementById(`textInput-news${i}`).value = t;
        }
        if (img) {
          const image = document.getElementById(`img-news${i}-${net}`);
          image.src = img; image.style.display='block';
        }
      });
    }
  };
</script>
</body>
</html>

