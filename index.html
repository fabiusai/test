<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Mockup</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <!-- Librerie -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #0033A0; margin-bottom: 20px; }
    .global-controls { text-align: center; margin-bottom: 10px; }
    .global-controls button { margin: 0 5px; padding: 8px 16px; cursor: pointer; }
    .news-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
    .news-tabs button { padding: 8px 16px; border: none; border-radius: 4px; background: #FFD700; color: #0033A0; cursor: pointer; }
    .news-tabs button.active { background: #fff; border: 2px solid #0033A0; }
    .social-tabs { display: flex; justify-content: center; gap: 10px; margin: 10px 0; }
    .social-tabs button { padding: 6px 12px; border: none; border-radius: 4px; background: #0033A0; color: #fff; cursor: pointer; }
    .social-tabs button.active { opacity: 0.8; }
    .tab-content, .social-section { display: none; }
    .tab-content.active, .social-section.active { display: block; }
    .mockup-container { background: #fff; width: 520px; margin: 0 auto; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .mockup-header img, .mockup-footer img, .mockup-image { width: 100%; display: block; }
    .mockup-text { padding: 10px 15px; font-size: 15px; white-space: pre-wrap; color: #050505; }
    .mockup-text span.link { color: #1877f2; }
    .controls { text-align: center; margin: 15px 0; }
    .controls textarea { width: 520px; height: 80px; padding: 10px; margin-bottom: 10px; font-size: 14px; }
    .controls input[type=file] { margin-bottom: 10px; }
    .controls button { margin: 0 5px; padding: 8px 16px; border: none; border-radius: 4px; background: #0033A0; color: #fff; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Social Mockup</h1>
  <div class="global-controls">
    <button onclick="resetAll()">Cancella tutto</button>
    <button onclick="downloadAll()">Scarica tutti (ZIP)</button>
  </div>
  <div class="news-tabs">
    <button class="active" onclick="changeNews(1, event)">News 1</button>
    <button onclick="changeNews(2, event)">News 2</button>
    <button onclick="changeNews(3, event)">News 3</button>
    <button onclick="changeNews(4, event)">News 4</button>
    <button onclick="changeNews(5, event)">News 5</button>
  </div>
  <!-- Sections for 5 news -->
  <!-- Each news block -->
  <script>
    const platforms = ['facebook','linkedin','x','instagram'];
    function buildTabs() {
      const container = document.createElement('div');
      container.innerHTML = platforms.map(net => `
        <button onclick="changeSocial(event,'${net}')">${net.charAt(0).toUpperCase()+net.slice(1)}</button>
      `).join('');
      return container;
    }
  </script>
  <!-- static content fallback -->
  ${[1,2,3,4,5].map(i => `
  <div id="news${i}" class="tab-content${i===1?' active':''}">
    <div class="social-tabs">
      ${platforms.map((net,k) => `
        <button class="${k===0?'active':''}" onclick="changeSocial(event,'${net}')">${net.charAt(0).toUpperCase()+net.slice(1)}</button>
      `).join('')}
    </div>
    ${platforms.map((net,k) => `
    <div id="section-${i}-${net}" class="social-section${k===0?' active':''}">
      <div class="mockup-container">
        <div class="mockup-header"><img src="Alto${net.charAt(0).toUpperCase()+net.slice(1)}.png" alt></div>
        <div class="mockup-text" id="text-${i}-${net}"></div>
        <img class="mockup-image" id="img-${i}-${net}" style="display:none">
        <div class="mockup-footer"><img src="Basso${net.charAt(0).toUpperCase()+net.slice(1)}.png" alt></div>
      </div>
    </div>
    `).join('')}
    <div class="controls">
      <textarea id="input-${i}" placeholder="Testo..."></textarea><br>
      <input type="file" id="file-${i}"><br>
      <button onclick="save(${i})">Salva</button>
      <button onclick="reset(${i})">Cancella</button>
    </div>
  </div>`).join('')}
  <script>
    let currentNews=1;
    let currentPlat='facebook';
    function changeNews(id,e){
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      document.querySelectorAll('.news-tabs button').forEach(b=>b.classList.remove('active'));
      e.currentTarget.classList.add('active');
      currentNews=id;
      document.getElementById('news'+id).classList.add('active');
      // reset social
      changeSocial(null,'facebook');
    }
    function changeSocial(e,plat){
      document.querySelectorAll(`#news${currentNews} .social-section`).forEach(s=>s.classList.remove('active'));
      document.querySelectorAll(`#news${currentNews} .social-tabs button`).forEach(b=>b.classList.remove('active'));
      currentPlat=plat;
      const sec=document.getElementById(`section-${currentNews}-${plat}`);
      sec.classList.add('active');
      if(e) e.currentTarget.classList.add('active');
    }
    function formatText(t){ return t.replace(/(#[\w]+|@[\w]+|https?:\/\/\S+)/g,m=>`<span class="link">${m}</span>`);
    }
    function save(i){
      const t=document.getElementById(`input-${i}`).value;
      const ftext=formatText(t);
      platforms.forEach((p,j)=>{
        if(currentPlat==='facebook'){
          document.getElementById(`text-${i}-${p}`).innerHTML=ftext;
        } else if(p===currentPlat) {
          document.getElementById(`text-${i}-${p}`).innerHTML=ftext;
        }
      });
      localStorage.setItem(`text-${i}-${currentPlat}`,t);
      const fileInp=document.getElementById(`file-${i}`);
      if(fileInp.files[0]){
        const reader=new FileReader(); reader.onload=()=>{
          platforms.forEach(p=>{
            if(currentPlat==='facebook'||p===currentPlat){
              const imgEl=document.getElementById(`img-${i}-${p}`);
              imgEl.src=reader.result; imgEl.style.display='block';
              localStorage.setItem(`img-${i}-${p}`,reader.result);
            }
          });
        }; reader.readAsDataURL(fileInp.files[0]);
      }
    }
    function reset(i){
      platforms.forEach(p=>{
        localStorage.removeItem(`text-${i}-${p}`);
        localStorage.removeItem(`img-${i}-${p}`);
        document.getElementById(`text-${i}-${p}`).innerHTML='';
        const imgEl=document.getElementById(`img-${i}-${p}`);
        imgEl.src=''; imgEl.style.display='none';
      });
      document.getElementById(`input-${i}`).value='';
      document.getElementById(`file-${i}`).value=null;
    }
    function resetAll(){ for(let i=1;i<=5;i++) reset(i); }
    function downloadAll(){
      const zip=new JSZip();
      const sections=document.querySelectorAll(`#news${currentNews} .social-section`);
      const promises=[];
      sections.forEach((sec,idx)=>{
        const wasHidden=!sec.classList.contains('active'); if(wasHidden) sec.classList.add('active');
        promises.push(
          html2canvas(sec.querySelector('.mockup-container'),{backgroundColor:'#ffffff'})
          .then(canvas=>new Promise(res=>canvas.toBlob(b=>{zip.file(`${currentNews}-${platforms[idx]}.jpg`,b);res();},'image/jpeg',1)))
          .finally(()=>{ if(wasHidden) sec.classList.remove('active'); })
        );
      });
      Promise.all(promises).then(()=>zip.generateAsync({type:'blob'}).then(b=>saveAs(b,`news${currentNews}.zip`)));
    }
    window.onload=()=>{ for(let i=1;i<=5;i++){ platforms.forEach(p=>{
        const t=localStorage.getItem(`text-${i}-${p}`);
        const im=localStorage.getItem(`img-${i}-${p}`);
        if(t) document.getElementById(`text-${i}-${p}`).innerHTML=formatText(t);
        if(im){ const el=document.getElementById(`img-${i}-${p}`); el.src=im; el.style.display='block'; }
      });
    }}
  </script>
</body>
</html>

